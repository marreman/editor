<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Edit test</title>
    <style>
      html {
        font-family: system-ui, sans-serif;
        caret-color: #2c70de;
      }

      body {
        max-width: 700px;
        padding: 30px;
        margin: 30px auto;
      }

      *::selection {
        color: white;
        background-color: #2c70de;
      }
    </style>
  </head>
  <body>
    <main>
      Pathos är ett centralt begrepp inom retoriken som där handlar om de starka
      känslor som en talare söker väcka hos sina åhörare, samt de känslor som
      faktiskt väcks hos publiken. Denna sinnesrörelse står oftast i samklang
      med de känslor som talaren själv visar. Tillsammans med ethos och logos
      utgör pathos en del av de grundläggande medlen för att övertyga. Den
      språkhandling som är knuten till pathos kallas movere och betyder just att
      röra eller påverka publikens känslor. Beroende på talets syfte kan talaren
      vilja väcka glädje, ilska, engagemang, medlidande, hopp, förtvivlan,
      längtan och så vidare. Även frånvaro av känslor hos talaren kan väcka
      känslor hos publiken.
    </main>

    <script>
      const keyboard = (() => {
        const listeners = {}

        document.addEventListener("keydown", (event) => {
          const chord = [
            event.shiftKey && "Shift",
            event.altKey && "Alt",
            event.ctrlKey && "Control",
            event.key,
          ]
            .filter(Boolean)
            .join("+")

          // console.log(chord)

          const fn = listeners[chord]

          if (!fn) return

          fn(event)
        })

        return {
          on(chord, f) {
            listeners[chord] = f
          },
        }
      })()

      const split = (s, at) => [s.slice(0, at), s.slice(at)]
      const trimStart = (s) => s.trimStart()
      const trimEnd = (s) => s.trimEnd()
      const juxt = (xs, fs) =>
        xs.map((x, i) => (fs[i] instanceof Function ? fs[i](x) : x))

      const addPeriod = (string, index) => {
        const [beginning, end] = juxt(split(string, index), [
          trimEnd,
          trimStart,
        ])
        const [firstLetter, restOfEnd] = split(end, 1)
        return beginning + ". " + firstLetter.toUpperCase() + restOfEnd
      }

      const addComma = (string, index) => {
        const [beginning, end] = juxt(split(string, index), [
          trimEnd,
          trimStart,
        ])
        return beginning + ", " + end
      }

      const addSpace = (string, index) => {
        const [beginning, end] = juxt(split(string, index), [
          trimEnd,
          trimStart,
        ])
        return beginning + " " + end
      }

      const selection = (() => {
        document.addEventListener("selectionchange", () => {
          console.log("selection change", window.getSelection().toString())
        })
        return {
          period() {
            const sel = window.getSelection()
            sel.focusNode.textContent = addPeriod(
              sel.focusNode.textContent,
              sel.focusOffset
            )
          },
          comma() {
            const sel = window.getSelection()
            sel.focusNode.textContent = addComma(
              sel.focusNode.textContent,
              sel.focusOffset
            )
          },
          space() {
            const sel = window.getSelection()
            sel.focusNode.textContent = addSpace(
              sel.focusNode.textContent,
              sel.focusOffset
            )
          },
          moveLeft() {
            const sel = window.getSelection()
            sel.collapseToStart()
            sel.modify("extend", "left", "word")
          },
          moveRight() {
            const sel = window.getSelection()
            sel.collapseToEnd()
            sel.modify("extend", "right", "word")
          },
        }
      })()

      keyboard.on(",", selection.comma)
      keyboard.on(".", selection.period)
      keyboard.on(" ", selection.space)
      keyboard.on("ArrowLeft", selection.moveLeft)
      keyboard.on("ArrowRight", selection.moveRight)
      keyboard.on("Enter", () => console.log(window.focus()))
    </script>
  </body>
</html>
